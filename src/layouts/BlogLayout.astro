---
import AppLayout from "@layouts/AppLayout.astro";
import Pagination from "@components/Pagination.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import { author } from "@data/socials";

interface Props {
  title: string;
  description: string;
  heroImage?: ImageMetadata;
  imageAlt?: string;
  pubDate: Date;
  url: string;
  category?: string;
  tags?: string[];
  lastmod?: Date;
}

const { 
  title, 
  description, 
  heroImage, 
  imageAlt = '', 
  pubDate, 
  url, 
  category,
  tags = [],
  lastmod 
} = Astro.props;

const ogImage = {
  src: `/image/${url}.png`,
  alt: title,
};

const fullPubDate = pubDate.toLocaleDateString("en", {
  dateStyle: "full",
});

const fullLastModDate = lastmod?.toLocaleDateString("en", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<AppLayout
  title={title}
  description={description}
  ogImage={ogImage}
  pubDate={lastmod ?? pubDate}
  tags={tags}
>
  <article class="max-w-4xl mx-auto">
    <header class="mb-16">
      <div class="mb-6">
        {category && (
          <span class="inline-block px-3 py-1 text-sm font-medium bg-blue-600 text-white rounded-full mb-4">
            {category}
          </span>
        )}
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-serif mb-6 text-zinc-100">
          {title}
        </h1>
        <div class="flex items-center gap-6 text-zinc-400">
          <time datetime={pubDate.toISOString()}>
            {fullPubDate}
          </time>
          {tags.length > 0 && (
            <div class="flex gap-2">
              {tags.map((tag) => (
                <span class="text-sm px-2 py-1 bg-zinc-800 rounded">#{tag}</span>
              ))}
            </div>
          )}
        </div>
      </div>
      
      {heroImage && (
        <div class="aspect-[2/1] overflow-hidden rounded-2xl">
          <Image
            src={heroImage}
            alt={imageAlt}
            class="w-full h-full object-cover"
            width={1200}
            height={600}
          />
        </div>
      )}
    </header>

    <div class="prose prose-lg dark:prose-invert max-w-none mb-16">
      <slot />
    </div>

    <footer class="border-t border-zinc-800 pt-8">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h3 class="text-zinc-100 font-semibold mb-1">Written by {author}</h3>
          {lastmod && (
            <p class="text-sm text-zinc-400">
              Last updated: {fullLastModDate}
            </p>
          )}
        </div>
        <div class="flex gap-4">
          <a 
            href="/blog"
            class="text-zinc-400 hover:text-zinc-100 transition-colors"
          >
            ← Back to Blog
          </a>
          <a 
            href="#top"
            class="text-zinc-400 hover:text-zinc-100 transition-colors"
          >
            ↑ Back to Top
          </a>
        </div>
      </div>
    </footer>
  </article>

  <Pagination />
</AppLayout>
